hooks:
  build:
    cmd: |
      mkdir -p $HOME/.local/bin
      curl -sSLf https://github.com/tsl0922/ttyd/releases/download/1.7.2/ttyd.x86_64 -o $HOME/.local/bin/ttyd
      chmod a+rx $HOME/.local/bin/ttyd

daemons:
  webide:
    run:
      cmd: |
        ./wait.sh
        set -x
        socat \
          TCP-LISTEN:8081,fork,reuseaddr \
          TCP-CONNECT:$(terraform -chdir=tf output -raw private_ip):$(terraform -chdir=tf output -raw vscode_server_port)
      dir: apps/aws-linuxvm

  ttyd:
    run:
      cmd: |
        ./wait.sh
        $HOME/.local/bin/ttyd -p 8080 ./term.sh
      dir: apps/aws-linuxvm
